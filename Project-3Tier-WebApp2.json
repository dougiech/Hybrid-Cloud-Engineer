{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"3-Tier Web Application","resources":{"client_attrs":{"None":{"y":270.4342975122,"x":58.8454265669},"cfc6ed32_deployment":{"y":130.5,"x":269.25},"918100ea_deployment":{"y":8.1640134068,"x":479.9591348404},"05e52c69_deployment":{"y":270.4342975122,"x":58.8454265669}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"846d858e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d7d5b3cb_runbook","main_task_local_reference":{"kind":"app_task","name":"846d858e_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4f3c2677_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e1f24fe8_runbook","main_task_local_reference":{"kind":"app_task","name":"4f3c2677_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"46e9a711_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"690d9553_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"e7fa7f03_runbook","main_task_local_reference":{"kind":"app_task","name":"46e9a711_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"252e3bb6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"172d1468_runbook","main_task_local_reference":{"kind":"app_task","name":"252e3bb6_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"7aaaac9c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"690d9553_runbook","main_task_local_reference":{"kind":"app_task","name":"7aaaac9c_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MySQL"}],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ff8953b5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"2e968788_runbook","main_task_local_reference":{"kind":"app_task","name":"ff8953b5_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"561d4a4f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0b5fddda_runbook","main_task_local_reference":{"kind":"app_task","name":"561d4a4f_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"933ecde8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"fea951a7_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"62ea2c83_runbook","main_task_local_reference":{"kind":"app_task","name":"933ecde8_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Stop"}],"name":"94f5de49_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop haproxy\r\nsudo systemctl daemon-reload\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"aae49195_runbook","main_task_local_reference":{"kind":"app_task","name":"94f5de49_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Restart"}],"name":"072db46f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl daemon-reload\r\nsudo systemctl restart haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fea951a7_runbook","main_task_local_reference":{"kind":"app_task","name":"072db46f_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"WebServer"}],"name":"HAProxy","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"38aa3a39_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"97826be3_runbook","main_task_local_reference":{"kind":"app_task","name":"38aa3a39_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"110952c1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a970169d_runbook","main_task_local_reference":{"kind":"app_task","name":"110952c1_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"082abb19_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"8cb36160_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"248e341a_runbook","main_task_local_reference":{"kind":"app_task","name":"082abb19_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Stop"}],"name":"0a480400_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6879c181_runbook","main_task_local_reference":{"kind":"app_task","name":"0a480400_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Restart"}],"name":"8358d6dd_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart mysqld\r\n# sudo systemctl status mysqld.service\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8cb36160_runbook","main_task_local_reference":{"kind":"app_task","name":"8358d6dd_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MySQL","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"WebServerAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"boot_config":true,"disk_list":{"0":{"device_properties":{"disk_address":{}}}}}}},"os_type":"Linux","create_spec":{"name":"www@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"0d12943a-105e-4954-8da3-6ea6f1fc344f"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"88f53659-cdf9-4019-98c2-aacb82a565b9","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"94bd7fdf-f255-48c3-9482-bd550bee7f57"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"HAProxyAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"boot_config":true,"disk_list":{"0":{"device_properties":{"disk_address":{}},"disk_size_mib":true}}}}},"os_type":"Linux","create_spec":{"name":"HAProxy-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"0d12943a-105e-4954-8da3-6ea6f1fc344f"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccadmin.username}@@\n    ssh-authorized-keys:\n      - @@{teccadmin.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"88f53659-cdf9-4019-98c2-aacb82a565b9","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"94bd7fdf-f255-48c3-9482-bd550bee7f57"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"MySQLAHV"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"07328169_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"43614f2d_runbook","main_task_local_reference":{"kind":"app_task","name":"07328169_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"MySQLAHV"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bd97a97b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"bc582f8d_runbook","main_task_local_reference":{"kind":"app_task","name":"bd97a97b_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"MySQLAHV","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"disk_list":{"0":{"device_properties":{"disk_address":{}}}},"memory_size_mib":true,"boot_config":true,"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"MYSQL-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"0d12943a-105e-4954-8da3-6ea6f1fc344f"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":1,"gpu_list":[],"memory_size_mib":1024,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: @@{teccdba.username}@@\n    ssh-authorized-keys:\n      - @@{teccdba.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"88f53659-cdf9-4019-98c2-aacb82a565b9","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CentOS_8_Cloud","uuid":"94bd7fdf-f255-48c3-9482-bd550bee7f57"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"MxefAV2G8+dNHbQiaCZZHluittkgffgRZUtIRjC5UPevhfpuWDxpwM0ONm9tNQzYKImoCRHUjAg0+w9CPGXC64+BoiicGL70WJfU+bnD8nHB1kCAgPMDHvmo7o3pjZw10Z6ZxP3ehVRe9j0agTmBlsv+MVlyqGJ5VKumLQ51DwuFS7Sdb6yAMbMSlyNpAXh6JFFy3SFPko7WRpmZl0BjotzIEFPCYSyyfhfi4JQzqyV3aFGHq9\/7XqziyfRbt8fsZCCxczon1I3R2jwc3eeSy6MxLvEifvU68kgMcvwvaJRelsJiirvgR5VOdtWPYuuaCoPA3JLWqjqw9hSHAxX8\/hOLd96uAtuSZczH6EAsWO46\/thcG0IiH7bv+Qy7WvBDbP3nHZDrPronvJ1C0MpaGWp+C7R8tBj9TjOgZL2gnk5BS+cXjUNxx\/kr+kibB0fwoEijo2JJmg9NxULMZ9g8HUWSKSeeAHk6GcnTHvyeYu\/YRc6PKs7tQgmwTCmPvzw2CX9uxdSehi+tB4s66PpkJpfDYlAsj7Z8lbZdFuUnN0LxBH1VEPlO6gEYbvtloaraGk7bkmSu1oZ+MNGCSuZX0\/D7HswjrSbQNvKmGRgRHjHX8o+goMj4C8sH\/sWt9VRLdhCerycrx0+qorH8cTALaj\/PQ+CH0G30lQgzg8WfVRRQJE1NLCECvfugSs+veXlGFwzVobCygUQaG9QkkZpHpTUKgvYGfHRnqP2vB6x6Ondf312v2ccQuEc\/UeF8nl9Pg4jB2KV1FBijb9LuAzoGEHvkbSzielwN3MegnVUSeJKtgdOyESLrZWljuMtEDJq9eac5yxdVE8iSzVofncyX5LUUi\/SIIOg4IykRfqVxvmDRCkc8MCFW4skus6NzuuUr2e57R3VDTUe5wpkxGJpyXBEe5C9QZGZgF3kCuJJAZAhQ1JwiJePqo1ssgvda1BE131CIYJUybS1VRNhCJKKkX6E5BVxi+ir7h0MZoPmmCvOrWc2wf4Db1scNK5S2\/1kGxPPV9hqDOqe4QvIXnamaMArkCb1xeWLNr+aIASVHVYsRILtoMNzL2yU7koJIwyy9mTmETnBmuwHjXC5TjB017pwFTes989nS+ucUU4dIBJoiYDmrqadXJlts0OfFkXBS06DytLg2dpoB33rprzQ5VXm1Tc4jBU\/o8NthAlNInmT\/K9zAESj12btKctCCRZs7SNx5GK1Zw0iIcPdYEZ+jjZvfNNMdi41HVSlvOjBfHIjcK7ksTQdio8ux\/6xSDN5jrh3MFCJPDHrqS0C9Qu+ySoZ\/vPnraaE933X6WKCIgBUP9pUgRNzX3BRVHCvlzMSg+xGNfvAHhmj5H76aQJnD+PeUyIk3KCFIq77Qbe69Es00Wgobhd2TNmNPCYg1kNW1auxJa81EwxjhhvJ21cepbopc3ImH9yW\/40lcxH4zLlom7FHCwNSA4vjNL1YprTNs5+TVUWZDyLE5Re2ANgDOOtLfrkEerdLdYNa5qWIvoOPzG2DLLgsOwm6ywwOw3VgZci4qdgWT\/urCpTYKHSjFnVcj4wKeKJtw5FYLDv78AWMws6PQ5Jx\/uiaWPL6OmY\/X0Ob3+mb+jEi9nfEifVataGbhl8Sy2ZB9rMcwfiuq9TFb8Ii99S\/QCobICP00CYIFNrKgZO9ZLmTatQq6Lw2oEPOIXVBb8sinSlj+boQCVq32EpJeHEBrczcODIzPq4aMsDyEgxmT4u3y3lDBA2LEePhLVUCV2Io05p\/hkJoNTUKoXu3xlGi0ZgSTm8LchgdLS7e3xZnklz+12HFT3axgvTQpG+OpQETHF81bCeLbV0fAEuVXWl2\/\/cAbaW5ttGQ\/IHe0o7Sn2itRubSdx9ZniCt5uWXklK609aL0yBXR6dv13GK8\/6ekVnHnfiJ\/7TJLoAwyYQsUbVlXuaEGj969AQ9C9VYz1G6oJGvzNeXreJWTu15sD9epRXEasQMDeQGMrfmR8tLQANxHCR2H1VgvOT\/aH6h+G+zZliz6uor7PvsEPWUBT7P3x+FVKpKlfZ18nBAtS7oIT\/d7sAjKLzDJITIglOT1Ck\/qIraigN3SJDeQwq0QLnZFgpgbTr7dOrpSxt1ykVa4h3WdXVoxGzol28XpdqHEo\/yVLrdQV3TF29jPFhk+T+SsaPWbDP+yVVb00KNJnrWQLaWCbP3a6ldHMeKLSXAFw3T0ig25ApvPP9rQPOuyX52qu60y+ZloFGXbLMtbMOMdNc6\/+suAup8KrnYA9jUuMgL00lfaY1J+LJi6nOkvHaVYyNTNxGxKDM+2TMRnsCcS3nhvgfhK94OcxcJJNx8DAMyeqOH+zJidgINyaCMYrtj0S0DehGae+v9Poq3221bHkcRxaP58TbFly2sbEGwDT3CtrEaTlT0+3y3O9AWrmXt0iiSGbkb07Pi4mEgFQNm5nnJBZ9ZFkHUz6ItkeptJaJB\/WWhX9K52e9R3D28PUAHM0vLohMnCEsqpmvpTnB\/qbSPgIQIOyE0uCYSW2mC++ydJq6N6HUE8dUMOEITX4L37sRQ9Vto4SOjDe2YMNPqebYjNBaZB3WdR3uJAFBNCCfYAQ0nHIgm8D1AtYUedKRovTohSYJx2Qs6IwtO\/7HG4UGFRlpaHcCLFxFB74CnVQRoCsCcbmKeSRbM8zIWCIevPMo2XCDqS3VoBiMQ2O\/ty7inCQNY34kElF0i\/5URy+uowa6TWQNavYEnqhqo5\/QuXQfW68UUvCV9YH7Y1SzbcMxEMnJ6GRDft87T4F9FdoBFycaQbtiNYE4kK9upfNqbEoIb8bxlKl6ZLweFRXGQKZLdVLx\/6kAjSeHw\/xo8d9QW0djBvHQzN9wlWZkYzCxW8H5ysvitSksksELXNYGk7XX5c\/xh7DQcBBmLIk8Ju5+PFdC1UzcKza+7y8bAvjmuKPKazmD6YLoEKTX5DQjCeAJuje2fO1mo0jdtAT1SAT2rP6AqgKIELb25Rgu1TsHcwjWOH0BoRe7dWUNpxEcCyrFGA0Nso2Bldfsl0OF6CI6B0xKrY9+Fgu290iETVpJbxz8al13sq38AiTesABeqoEHZLAZMWF3tfHI1uoaJsim4EkCRFeDySdIYOV8xZOZBlcfnokHvYq0wGjOfJ7wmQyB8SbBVGbdkKnZ0RQB9RsImsQHBzrGuupYjOlcYYlZ6pSYSTKR5st0AZTYB+v3I9iAu\/PJGPWuQRkbT2MHv0rnzRcEeiEDzWajEork14JRWUJ5CoiiNRct+M9pPWP\/+MNu2m451WEVN7\/rFUowMDyLEL7M3Fz5lhlbhinzoYbkZT:utf-8"},"name":"teccadmin"},{"username":"teccdba","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"LBkuSsRQRM8qBwY05nKbN\/BlH0cG8dJwVc9o91i6oloLUXfv7Pozu8Y1T7m+Skk76ON5GradUGB24fVMRVdqIbN6TCbYmE9vWQnw7HGhKQIkGyN186Kk56eghI9ReK4g+DUCZmi87e\/M0vuWNg+USmqJGyIOrksvguYFHxxGtqI2\/8vpl9u9jL9lGecdX83qq++BLSK+X570OWLseWE9+u4vkoLFgjareDgvr0wP7XWA0qChPkdBgiJYKFHYOUwFDLUqKqsyZQoZglXERuCYYJjAK2RPDw+eshmNAitFD5CKnscaul\/Lyy\/L90g1H70eZHhtMv1gpxU2dL0SCvjAF9jc74ByYby8TdzF2tDiHXIOHPsUXnE+Ku1qq5kedbns+8siVGQUCUM3TrR5s0By\/wwHRJ\/lzSDp0GHW1p+0A\/3u7R7bWGiuXqgiFRrlGxxCj8VM5hv0ywoHtH4bwiJXDWyRMrj58Emt2e77WH8ZNYUP1IV9vNv1zQN9KiD8sHlFP3QP1XUGhofcB\/XOgW3JGe1Laia9e6KIZLh+k8oou3hdXjgbbtLkgoPIS3aenlLV+YdddBZ2TqRP0ghIQkQscWvhaR+j7GUl\/fSWT7oVafPis2z4\/VGAJujnI8oakGmXe3dir9T6fgXykkQQijlhyxritn0W\/kgdImiXXZk0CJTFMZ1M+GMF9UArBVpQhiEiynrny9YIuT40MTRsVhVyW157l5HSYKR42\/aBkM5jY71To62kLv6a\/WWoXg9XDcZKtnEgjUgRUIvEaAYksxu0hLtHLe2OPpOUr8MEKBKJMExfo09DkxpDGQfPrKrnRo9BvJ6gkr5B8Kzfioe4Ioc6B0EBEgNMIqhbv3jgAp1qRn0GDa8u6vFsymsjwv0pTwGFVhqnObqlXMklJcHA+ogr6VzhprIL0WaNQGfB3QlH7A2rkBGKxy9DXajiVzoX0pAcfOzotxg0HYhQocQgKTfhPJUmpjoljG3u0w9z97abU5mFVhcWGClNIk6ePdOF6857G7vHWSU6e2sSHn1P7pASu+wVFo+he+wMA+qPe1Lm1Yy2gH9ewIknXUtpRBIolkfn8msaFMrEEupkM8M9K+W+VvkDAJ3EYI3cwOOhgq0q7kWcMtFC4KDIPMNfz6P0hXbMBc4rgxcRYnNZNS2QURB\/zReMPzHGmomakuB0Df31dNQG5LPN9XDfJunRHAnky6sSUERhhkSTNqbtN\/GMHV5bepE6MvDK16bKUyhk00Ojppq2mhS8IZKYXjROPDG\/BfplWOjXPoVnwktVuU8wHeYNTytjuVR+Z1lye6MM2a\/R5idOOI4Skw6gohCOlUPnMh5J\/OQn0RT6ZH\/Nv0hYhKKmfXqORD6imKz2P6NkiodoYIcCn6ewz5xjI52i8wxtHg+BhjdDy5w4g6Mrt4caLmP5Q4SFKipSACeJpPIlslscb1CfpbSOIzy6uMDbx1RkJB3JOXLEJPLw9uaIMmZiXir2XPy69e+1EAaOr6xkCIWbHVEg5XFA9bRVTrtXuNJIesKRhYY1fk7gSV8WZ+Rd0qfSxDPl4mgiGBh+y9uLYVl9dFa6gUG4EXHoRf7oOUROP42qw4TmdbOf7TDlrgKFkH29xerxAZowlDzcBwlgDUAOTsn899i0OpKfW36aNf\/5b7oyBTCCxrS7iBRANi5U4TBAeb8N9rYx6OiO9JHbNGFbGrRx3YkX12pIKElKSdvlEZlOBdoW9usSynV++xiBhFuo6qqk4IHgoa1Tknb17Zj3dl\/i7JYbhoEXFy37Cs3Oq+tFvhZddYUGLa4YgrSUUGD4YtjmVFbMmLtz4me2q6MDKuuW0SFEbIt3IHMMQMwh+0SoRrsnRn0+yscafnXccdmVULDLzgPnxEIzNl6dMMcE+pBvYG3RlUzcTXHbTNnkXQVUEq5+\/Sg0dlKoGFjXO9osDCR5nlsaacDYbURpUc5t0YW0\/65zpFlT5XwtRDm3G51qvcVWEHka1ZwN6uPHbMuSleoSd8R\/L1fSxWp61qKo9wQy\/VJaakxxnsZEwyvz4EUVuDz2nh66o71i6pzg2DUlE\/1seqeFFaRGYWBcK8VH3NdJD+UmLqEBZr2ICMnTFPZzbrA0ItDkD0kbiWpcmwsTfSJxEbYd\/dJJ+Wad\/A7sDqi9iTr6Dhomgnu1v9KvJ2RV1DdZ850SNoIf5BztCS2EEKr6Stnn55wypcVl0R17BocrxiYZE\/jEmcoY7vB7LwgC9gaZ9AaIQ\/A1Xbkfq\/21n89lV60UijBVG\/GeQAIIJbCKRQheDkP0lhfJhJ0x2lFEkq9M6h12Vv1lr6j7AcNFw3VW4rLKwgqje+D4Uy6X6PnnW8wN5Ht7R+gsJAH1TlZRjbKOB9VrwEbFrqiKeKP3QeYn85DFeyAv05BerKYBHAIMwUMx9kiyn7PjDlpfaz+BGM03A3ZkgP7Y9z\/ZWHKajzy7BxHDAB1uSWpsIeLjMXwirSEf3dqoW9R0LOV8jBv+\/pK9VVZdbZPr1q7UGCj2CBD0YTPdQ9A5Omi4sk44VHg5qq82ZxppfhNV19Ey6DF5WeEq0pCaCckgKvhpo6VDuAkV4cd6H2Ci3ZC0ubJKiSLzMUFvnehqHLusdiU3mA8WPFsLWOTonEV+jkzQiOiRyjrz2X7UCHxUALWXUH9HgHnONaWF560ry2C8U92ttYVBtmDGnEF0PofhVLwiKITgHmoEs1LK5wCHy8Epin8yMEbYA+GsVDccmG3qVCoKLFuAmsZk9CtyBlkiajcE7sM7rOWLTeNPKUbQx8b7YGRME\/DxtsXCHsZRdV\/HFMFND336sB9zI4DIcKhGbyBYv4iq998+edxL7MI6y95APvFuKYdULsQ4PvH9ayhuYY4\/pW3hRJQ07Ud5Gdz3bthKe\/TFUZIt+Rk5t\/T2nyTUSB50aw0ocrf0LXUapu4qS6l8OW5RUAXAfoOlkimwbmhuiB2oIjrvsypDDRp9IV70I\/xTdD\/BtDNPHdGlX8vjhpBBUTiDCDd5EbZptnoXuGXByRjIUCSBomOWrLCcMdGiS\/nYB0l8fCyIyZ7L\/HaUdbNORDPf2s2qrcvBxBBLyb2Opkl4Na2kEpPoDPK0w5JtCYBL6PrBK8ZKXwziNOftMzTUmichCLD+uQViWoUr6G5ZlAV7sFxxCKxBD66Z\/2NLZFPfmNhYeshkQWDYXRUhBpsCowfzzvb7R8RgR3PdsHvptDJKj1Vs72VE4ZwwKImXhyK70FOZAB206J\/+hX7K6XTOB+S3g4JtBX6OPCAjAu\/XEoYOAVWg65SakuGqY\/anoupWkZEGpRIAnKzX:utf-8"},"name":"teccdba"}],"package_definition_list":[{"description":"CentOS 8 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"WebServer_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"Install_WebServer"},{"kind":"app_task","name":"3Tier_Webapp"}],"name":"4aaeecb9_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install_WebServer"}},{"from_task_reference":{"kind":"app_task","name":"Install_WebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"3Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n\r\n# temporarily disable SELinux to prevent httpd to MySQL authentication issues\r\n# this is for testing only and should not be done in production environments\r\necho \"__ Temporarily disable SELinux...\"\r\nsudo setenforce 0\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"3Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\nsudo touch \/var\/www\/html\/index.php\nsudo chown @@{teccdba.username}@@:@@{teccdba.username}@@ \/var\/www\/html\/index.php\n\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\n<html>\n  <head>\n    <title>TECC Test Web Application<\/title>\n  <\/head>\n  <body>\n   <h1>TECC Test Web Application<\/h1>\n  <?php\n  try {\n    $dbh = new PDO('mysql:host=DATABASE_ADDRESS;dbname=webapp', \"@@{MYSQL_APP_USER}@@\", \"@@{MYSQL_PASSWORD}@@\", array(\n      PDO::ATTR_PERSISTENT => true,\n      PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n    ));\n\n    \/\/ ensure there is at least 1 row of data for the app to read\n    $data = $dbh->query(\"INSERT INTO tecc_dba_test (id, time, comment) VALUES (NULL, CURRENT_TIMESTAMP, \"$_SERVER['SCRIPT_NAME']\")\");\n\n    $data = $dbh->query('SELECT MAX(id) AS count FROM tecc_dba_test')->fetchAll(PDO::FETCH_COLUMN);\n    $count = $data[0]; \/\/print_r($data);\n    $data = $dbh->query(\"SELECT time, comment FROM tecc_dba_test WHERE id = $count\")->fetchAll(PDO::FETCH_ASSOC);\n    $time = $data[0]['time'];\n    $comment = $data[0]['comment'];\n\n    echo \"<p>Database records: $count<\/p>\\n\";\n    echo \"<p>Last comment: $comment, on: $time<\/p>\\n\";\n    echo \"<h3>Web docroot: $_SERVER['DOCUMENT_ROOT'], file: $_SERVER['SCRIPT_NAME']<\/h3>\\n\";\n\n    $dbh = null;\n  }\n  catch (PDOException $e) {\n    print \"Error!: \" . $e->getcomment() . \"<br\/>\";\n    print phpinfo();\n    die();\n  }\n  ?><\/body>\n  <\/html>\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fcf17d22_runbook","main_task_local_reference":{"kind":"app_task","name":"4aaeecb9_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"73c0a201_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"61cf3347_runbook","main_task_local_reference":{"kind":"app_task","name":"73c0a201_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAProxy"}],"name":"HAProxy_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"HAProxy_Install"}],"name":"b967f788_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"cb220392_runbook","main_task_local_reference":{"kind":"app_task","name":"b967f788_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_HAProxy"}],"name":"4e1a9c5b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_HAProxy","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y erase haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"eb83a7b9_runbook","main_task_local_reference":{"kind":"app_task","name":"4e1a9c5b_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MySQL"}],"name":"MySQL_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"MySQL_Install"}],"name":"12805f16_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"MySQL_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\nset -ex\n\n# Assuming CentOS\/RedHat 8.2\necho \"__ Mysql installation...\"\n# https:\/\/dev.mysql.com\/doc\/refman\/8.0\/en\/linux-installation-yum-repo.html\n\nsudo yum install -y \"http:\/\/repo.mysql.com\/mysql80-community-release-el8.rpm\" &&\n  sudo yum module -y disable mysql &&\n  sudo yum install -y mysql-community-server\n\n# database must be started for SQL configuration\nsudo systemctl start mysqld\n# database should start on OS boot\nsudo systemctl enable mysqld\n# sudo systemctl status mysqld.service\n\necho \"__ Altering database root password...\"\n\nmysql --user=root --connect-expired-password \\\n  --password=\"$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\" <<- EOF\n\nSET GLOBAL validate_password.policy=LOW;\nALTER user 'root'@'localhost' IDENTIFIED BY '@@{MYSQL_PASSWORD}@@';\n\nFLUSH PRIVILEGES;\nEOF\n\necho \"__ Creating database, table, and app user permissions...\"\n\nmysql --user=root --password='@@{MYSQL_PASSWORD}@@' <<- \"EOF\"\n\nCREATE DATABASE IF NOT EXISTS webapp ;\nCREATE TABLE IF NOT EXISTS webapp.tecc_dba_test ( \\\n  id INT NOT NULL AUTO_INCREMENT , \\\n  time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP , \\\n  comment VARCHAR(80) NULL DEFAULT NULL , \\\n  PRIMARY KEY (id)) \\\n  ENGINE = InnoDB CHARSET=ascii COLLATE ascii_general_ci COMMENT = 'testing';\n\nFLUSH PRIVILEGES;\nCREATE USER 'tecc_webuser'@'%' IDENTIFIED WITH mysql_native_password BY 'end-user-provided-password' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO 'tecc_webuser'@'%';\n\nCREATE USER 'tecc_webuser'@'localhost' IDENTIFIED WITH mysql_native_password BY 'end-user-provided-password' \\\n  REQUIRE NONE WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0;\nGRANT SELECT, INSERT ON *.* TO 'tecc_webuser'@'localhost';\n\nFLUSH PRIVILEGES;\nEOF\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"d6835156_runbook","main_task_local_reference":{"kind":"app_task","name":"12805f16_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MySQL_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"MySQL_Uninstall"}],"name":"0f6afa65_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"MySQL_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\necho \"Generic uninstall script, goodbye!\"\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccdba"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"185771f1_runbook","main_task_local_reference":{"kind":"app_task","name":"0f6afa65_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"cfc6ed32_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"WebServer_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"918100ea_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAProxy_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAProxyAHV"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"05e52c69_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MySQL_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"MySQLAHV"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleOut"},{"kind":"app_task","name":"HAProxy_Update"},{"kind":"app_task","name":"Restart"}],"name":"e131a329_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"HAProxy_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}},{"from_task_reference":{"kind":"app_task","name":"ScaleOut"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Update"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"cfc6ed32_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleOut","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"fea951a7_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"548bbabb_runbook","main_task_local_reference":{"kind":"app_task","name":"e131a329_dag"},"variable_list":[]},"name":"WebScaleOut"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Update"},{"kind":"app_task","name":"Restart"},{"kind":"app_task","name":"ScaleIn"}],"name":"c6832417_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"HAProxy_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Restart"}},{"from_task_reference":{"kind":"app_task","name":"Restart"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"ScaleIn"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy || true # idempotent\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\nport=80\r\n\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:${port}\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\n\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"fea951a7_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"cfc6ed32_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleIn","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"e5ced864_runbook","main_task_local_reference":{"kind":"app_task","name":"c6832417_dag"},"variable_list":[]},"name":"WebScaleIn"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"DatabaseBackup"}],"name":"da299169_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MySQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"DatabaseBackup","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nmysqldump --all-databases --user=root --password='@@{MYSQL_PASSWORD}@@'\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"teccadmin"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"b43a37e5_runbook","main_task_local_reference":{"kind":"app_task","name":"da299169_dag"},"variable_list":[]},"name":"DatabaseBackup"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"DC","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_APP_USER","value":"webapp_user","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"MySQL low password security requirements are 8 or more characters with at least 1 uppercase character.","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"IVPcW0SPXI4rbNR0XclCLlSTxJ3D6BTKIVaSXYczlXuYx\/PBRIfvOGH6:utf-8","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_NAME","value":"webapp","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_TABLE","value":"tecc_dba_test","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"teccadmin"},"type":"USER"},"name":"Project-3Tier-WebApp"},"api_version":"3.0","metadata":{"last_update_time":"1610800551840981","kind":"blueprint","spec_version":16,"creation_time":"1610798359347094","name":"Project-3Tier-WebApp"}}